define("init/init",["jquery","ajax","dialog","./config","utils","./extend/utils","./extend/jquery","./extend/dialog"],function(a){var b=a("jquery"),c={};window.mining=c,window.$ajax=a("ajax"),window.$dialog=a("dialog"),b.extend(c,a("./config")),c.utils=a("utils"),a("./extend/utils"),a.async("./extend/extend.css"),c.ajaxTimeout=c.utils.loadLogin,a("./extend/jquery"),a("./extend/dialog"),a.async("bootstrap/3.3.0/js/bootstrap.min.js"),c.utils.winResize({name:function(){b.extend(c.browser,c.utils.getBrowserInfo())}},!0),c.browser.msie&&c.browser.iev<9&&(a.async("html5shiv"),a.async("respond")),b(function(){if(c.browser.msie&&c.browser.ie6)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(a){}if(c.browser.msie)try{window.setInterval("CollectGarbage();",1e4)}catch(a){}seajs.log("common init complete!")})}),define("init/config",[],function(){var a={};return a={browser:{w:1024,h:768,msie:!1,ie6:!1,iev:void 0},keyCode:{ENTER:13,ESC:27,END:35,HOME:36,SHIFT:16,TAB:9,LEFT:37,RIGHT:39,UP:38,DOWN:40,DELETE:46,BACKSPACE:8}}}),define("init/extend/utils",[],function(a){mining.utils=$.extend(mining.utils,{initUI:function(b,c){var d=$(b||document);if($("input.select2-ipt, select.select2-ipt",d).each(function(){$(this).select2()}),$("input.daterangebox-ipt",d).size()>0){var e=function(a){a.data("daterangepicker")||a.daterangepicker({format:"YYYY-MM-DD"},function(b,c,d){console.log(b.toISOString(),c.toISOString(),d);var e=a.data("change");!mining.utils.isEmpty(e)&&$.isFunction(e)&&e.call(a)})};$("input.daterangebox-ipt",d).each(function(){$(this);e($(this))}),mining.utils.isEmpty(mining.daterangepicker)&&(mining.daterangepicker=function(a){setTimeout(function(){e(a)},100)})}if($("input.datetimebox-ipt",d).size()>0){var e=function(a){a.data("daterangepicker")||a.daterangepicker({startDate:moment().format("YYYY-MM-DD")+" 12:00",timePicker:!0,timePicker12Hour:!1,singleDatePicker:!0,timePickerIncrement:1,format:"YYYY-MM-DD HH:mm"},function(b,c,d){console.log(b.toISOString(),c.toISOString(),d);var e=a.data("change");!mining.utils.isEmpty(e)&&$.isFunction(e)&&e.call(a)})};$("input.datetimebox-ipt",d).each(function(){$(this);e($(this))}),mining.utils.isEmpty(mining.daterangepicker)&&(mining.daterangepicker=function(a){setTimeout(function(){e(a)},100)})}$("form.required-validate",d).size()>0&&a.async("validate",function(){$("form.required-validate",d).each(function(){var a=$(this);a.validate({onsubmit:!1,focusInvalid:!1,focusCleanup:!0,errorElement:"span",ignore:".ignore",invalidHandler:function(a,b){b.numberOfInvalids()}}),a.find("input[customvalid]").each(function(){var a=$(this);a.rules("add",{customvalid:a.attr("customvalid")})})})}),$("input[type=radio]").addClass("ipt_radio"),$("input[type=checkbox]").addClass("ipt_checkbox"),$("input[disabled=disabled],textarea[disabled=disabled],select[disabled=disabled]").addClass("disabled"),$("input[readonly=readonly],textarea[readonly=readonly],select[readonly=readonly]").addClass("readonly"),$("input,textarea,select",d).each(function(){mining.utils.isEmpty($(this).attr("class"))||-1==$(this).attr("class").indexOf("required")||$(this).addClass("required")}),$.isFunction(c)&&c.call()},hoverClass:function(a){var b=new Array;b=a.split(",");for(var c in b)$(b[c]).hoverClass()},loadLogin:function(){try{$dialog.getCurrent().close()}catch(b){}$dialog({title:"请重新登录",content:['<div class="loginbox">','<form class="form-signin" onsubmit="return false;">','<strong class="title">登录</strong>','<div class="item">','<input name = "username" class="name required" type="text" placeholder="用户名" autofocus>',"</div>",'<div class="item">','<input name="password"  class="password required" type="password" placeholder="密码">',"</div>",'<div class="item">','<label class="remember"><input name="rememberme" id="rememberBox" type="checkbox" >保持登录状态</label>','<a class="forget" href="javascript:;">忘记密码？</a>',"</div>",'<input type="hidden" id="remember" name="remember">','<div class="item">','<input class="btn-submit" type="submit" value="登录">',"</div>","</form>","</div>"].join(""),onshow:function(){var b=this,c=$(this.node);setTimeout(function(){$("input:-webkit-autofill").each(function(){var a=$(this).val(),b=$(this).attr("name");$(this).after(this.outerHTML).remove(),$("input[name="+b+"]").val(a)})},1e3),$(".btn-submit",c).on("click",function(){a.async("validate",function(){("admin"==$("[name=username]",c).val()||$("form",c).valid())&&$ajax.ajax({url:"/trp/login/do_login_ajax/",data:JSON.stringify({username:$("[name=username]",c).val(),password:$("[name=password]",c).val(),remember:$("[name=rememberme]",c).val()}),contentType:"application/json",type:"POST",dataType:"json",success:function(){return $("[name=username]",c).val()!=$(".btn-user").text()?void mining.utils.gotoUrl("/trp/"):void b.close()},error:function(){$(".forget",c).siblings("label.error").remove(),$(".forget",c).after('<label for="attr_name" generated="true" class="error">用户名或密码错误，请检查</label>')}})})}),$(".name,.password",c).on("focus",function(){$(".forget",c).siblings("label.error").remove()})}}).showModal()},alertMsg:function(a,b,c){var d=mining.utils.isEmpty(b)?"":b;mining.utils.isEmpty(a)||mining.utils.isEmpty(a.message)||(d+="：<b>"+a.message+"</b>"),"success"==c||"warning"==c||"error"==c?$dialog.alert(d,c):$dialog.alert(d)}})}),define("init/extend/jquery",[],function(){!function(a){a.extend(a.fn,{initUI:function(a){return this.each(function(){mining.utils.initUI(this,a)})},hoverClass:function(b){var c=b||"hover";return this.each(function(){a(this).hover(function(){a(this).addClass(c)},function(){a(this).removeClass(c)})})},isTag:function(b){return b&&void 0!=a(this)[0]&&void 0!=a(this)[0].tagName&&a(this)[0].tagName.toLowerCase()==b?!0:!1}})}(jQuery)}),define("init/extend/dialog",["jquery","dialog"],function(a){var b=a("jquery"),c=a("dialog");c.topIndex=function(){if(mining.utils.isEmpty(c)||mining.utils.isEmpty(c.list))return 2014;var a=[];return b.each(c.list,function(b,c){a.push(c.zIndex)}),a.max()+1},c.alert=function(a,b,d,e){var f,g=3e3;if("number"==typeof a&&(a+=""),"string"!=typeof a)return void seajs.log("调用 $dialog.alert 时类型出错！暂只支持字符型，请检查。");mining.utils.isEmpty(c.get("Alert"))||c.get("Alert").close(),"number"==typeof b?(g=b,b="message"):"function"==typeof b&&(e=b,b="message"),"function"==typeof d&&(e=d),"number"==typeof d&&(g=d),"success"==b?(f="成功啦",a='<span class="artui-dialog-alert-success"></span><span>'+a+"</span>"):"warning"==b?(f="提醒",a='<span class="artui-dialog-alert-warning"></span><span>'+a+"</span>"):"error"==b?(f="出错啦",a='<span class="artui-dialog-alert-error"></span><span>'+a+"</span>"):f="消息",a='<div class="artui-dialog-alert">'+a+"</div>";var h=c({title:f,id:"Alert",zIndex:c.topIndex(),fixed:!0,time:g,padding:"15px 30px",content:a,okValue:"知道了",ok:!0,onbeforeremove:e}).show();return 0!=g&&setTimeout(function(){h.close().remove()},g),h},c.confirm=function(a){return a=b.extend({title:"提醒",content:"您确定要执行本操作？",zIndex:c.topIndex(),fixed:!0,padding:"15px 30px",cancelValue:"取消",cancel:!0,okValue:"确定",ok:!0},a),a.content='<span class="artui-dialog-confirm"></span><span>'+a.content+"</span>",c(a).showModal()}});
